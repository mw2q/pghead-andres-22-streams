BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%beige%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 269594606.097252
 ALGERIA                   |   1997 | 454419400.550697
 ALGERIA                   |   1996 | 451560037.643228
 ALGERIA                   |   1995 | 459382634.000095
 ALGERIA                   |   1994 | 460752359.704337
 ALGERIA                   |   1993 | 460627297.806525
 ALGERIA                   |   1992 | 463656931.067278
 ARGENTINA                 |   1998 |  270719089.07514
 ARGENTINA                 |   1997 | 469997678.696016
 ARGENTINA                 |   1996 | 468315135.812988
 ARGENTINA                 |   1995 | 459184016.904226
 ARGENTINA                 |   1994 | 459876752.442213
 ARGENTINA                 |   1993 | 463620997.853258
 ARGENTINA                 |   1992 | 453028016.101157
 BRAZIL                    |   1998 | 276366698.636994
 BRAZIL                    |   1997 | 479286796.434982
 BRAZIL                    |   1996 | 468433562.908256
 BRAZIL                    |   1995 | 472807460.051612
 BRAZIL                    |   1994 | 473940339.147576
 BRAZIL                    |   1993 | 466062385.740963
 BRAZIL                    |   1992 | 475675780.886558
 CANADA                    |   1998 | 277682604.546654
 CANADA                    |   1997 | 471632538.874795
 CANADA                    |   1996 |  465056123.16382
 CANADA                    |   1995 | 472484862.742233
 CANADA                    |   1994 | 478312436.932079
 CANADA                    |   1993 | 467422487.589352
 CANADA                    |   1992 | 477703097.953425
 CHINA                     |   1998 | 278021139.301762
 CHINA                     |   1997 | 476221107.354843
 CHINA                     |   1996 | 462540499.451881
 CHINA                     |   1995 | 467477261.462112
 CHINA                     |   1994 | 471101245.158915
 CHINA                     |   1993 | 469811678.284532
 CHINA                     |   1992 | 479859212.398752
 EGYPT                     |   1998 | 272061124.407816
 EGYPT                     |   1997 | 470927257.514374
 EGYPT                     |   1996 | 472587461.698176
 EGYPT                     |   1995 | 463299015.380403
 EGYPT                     |   1994 |  460383047.07193
 EGYPT                     |   1993 | 462352573.756877
 EGYPT                     |   1992 | 465827210.027555
 ETHIOPIA                  |   1998 | 269959581.258535
 ETHIOPIA                  |   1997 |   452851384.5518
 ETHIOPIA                  |   1996 |  452575672.48015
 ETHIOPIA                  |   1995 | 457382125.485829
 ETHIOPIA                  |   1994 | 461037477.184284
 ETHIOPIA                  |   1993 | 455642108.417735
 ETHIOPIA                  |   1992 | 463484794.523743
 FRANCE                    |   1998 | 262456744.393675
 FRANCE                    |   1997 | 459698443.085121
 FRANCE                    |   1996 | 461930633.350034
 FRANCE                    |   1995 |  447090068.10352
 FRANCE                    |   1994 | 456649611.709351
 FRANCE                    |   1993 | 457331636.938299
 FRANCE                    |   1992 | 462238650.279266
 GERMANY                   |   1998 | 276144876.514725
 GERMANY                   |   1997 | 478965853.158578
 GERMANY                   |   1996 | 478457917.402633
 GERMANY                   |   1995 | 488571710.225049
 GERMANY                   |   1994 | 483060403.365682
 GERMANY                   |   1993 | 485725657.948493
 GERMANY                   |   1992 | 484057047.285942
 INDIA                     |   1998 | 272949237.134536
 INDIA                     |   1997 | 475878928.714651
 INDIA                     |   1996 | 478357045.351605
 INDIA                     |   1995 | 472834672.557308
 INDIA                     |   1994 |  468629130.26879
 INDIA                     |   1993 | 471490896.113206
 INDIA                     |   1992 | 475887416.057071
 INDONESIA                 |   1998 | 275070068.125253
 INDONESIA                 |   1997 | 476216599.975505
 INDONESIA                 |   1996 | 475421478.341025
 INDONESIA                 |   1995 | 465435394.869599
 INDONESIA                 |   1994 | 473486106.565313
 INDONESIA                 |   1993 | 468496543.441262
 INDONESIA                 |   1992 | 462968617.068063
 IRAN                      |   1998 | 274046562.841174
 IRAN                      |   1997 | 463195836.663457
 IRAN                      |   1996 | 464192787.651897
 IRAN                      |   1995 | 460540807.332938
 IRAN                      |   1994 | 457484862.791481
 IRAN                      |   1993 | 454305618.441566
 IRAN                      |   1992 | 464025992.393806
 IRAQ                      |   1998 | 275747064.560981
 IRAQ                      |   1997 | 460904824.168435
 IRAQ                      |   1996 | 478265498.861656
 IRAQ                      |   1995 | 475454547.383851
 IRAQ                      |   1994 | 469089846.717633
 IRAQ                      |   1993 | 468743541.898693
 IRAQ                      |   1992 | 475178057.277206
 JAPAN                     |   1998 | 270593026.859666
 JAPAN                     |   1997 | 454233913.675726
 JAPAN                     |   1996 | 458300594.831932
 JAPAN                     |   1995 | 453914853.893544
 JAPAN                     |   1994 | 456676094.371889
 JAPAN                     |   1993 | 461654146.042575
 JAPAN                     |   1992 | 461371456.966337
 JORDAN                    |   1998 | 270915859.729708
 JORDAN                    |   1997 | 458664917.302452
 JORDAN                    |   1996 | 456790978.624649
 JORDAN                    |   1995 | 455403502.354565
 JORDAN                    |   1994 | 456213744.011777
 JORDAN                    |   1993 | 462424273.837278
 JORDAN                    |   1992 | 467527055.505455
 KENYA                     |   1998 | 268483710.391204
 KENYA                     |   1997 |  472312641.25498
 KENYA                     |   1996 | 465642733.084907
 KENYA                     |   1995 | 468625821.289554
 KENYA                     |   1994 | 470403615.543038
 KENYA                     |   1993 | 463105347.408467
 KENYA                     |   1992 | 475473321.819511
 MOROCCO                   |   1998 | 272602411.833546
 MOROCCO                   |   1997 | 458157555.849909
 MOROCCO                   |   1996 | 472681132.682261
 MOROCCO                   |   1995 | 468884237.590389
 MOROCCO                   |   1994 | 462847057.247096
 MOROCCO                   |   1993 | 468150352.026225
 MOROCCO                   |   1992 | 468080051.327904
 MOZAMBIQUE                |   1998 | 265283351.495291
 MOZAMBIQUE                |   1997 | 442783807.941877
 MOZAMBIQUE                |   1996 | 455421204.521018
 MOZAMBIQUE                |   1995 | 454242601.960758
 MOZAMBIQUE                |   1994 | 452978561.305709
 MOZAMBIQUE                |   1993 |  447581776.22634
 MOZAMBIQUE                |   1992 | 445349289.416723
 PERU                      |   1998 | 278577191.193221
 PERU                      |   1997 | 476763515.161508
 PERU                      |   1996 | 465162572.203458
 PERU                      |   1995 | 468693970.905999
 PERU                      |   1994 | 469394686.565184
 PERU                      |   1993 | 470835753.453744
 PERU                      |   1992 | 467538804.653954
 ROMANIA                   |   1998 | 272235033.037939
 ROMANIA                   |   1997 | 456144922.523989
 ROMANIA                   |   1996 |  465280110.91864
 ROMANIA                   |   1995 | 451613956.147542
 ROMANIA                   |   1994 | 455020802.713591
 ROMANIA                   |   1993 |  458256826.92006
 ROMANIA                   |   1992 | 456166274.088707
 RUSSIA                    |   1998 | 280512766.521782
 RUSSIA                    |   1997 | 476466374.203522
 RUSSIA                    |   1996 | 472948511.972926
 RUSSIA                    |   1995 | 477575977.305905
 RUSSIA                    |   1994 | 473121261.633792
 RUSSIA                    |   1993 | 478129336.214071
 RUSSIA                    |   1992 | 475957858.804817
 SAUDI ARABIA              |   1998 |  277467010.86771
 SAUDI ARABIA              |   1997 | 476837898.958838
 SAUDI ARABIA              |   1996 | 467990765.350579
 SAUDI ARABIA              |   1995 | 475443718.678984
 SAUDI ARABIA              |   1994 |  467679867.57543
 SAUDI ARABIA              |   1993 | 473414269.855224
 SAUDI ARABIA              |   1992 | 478657246.906614
 UNITED KINGDOM            |   1998 | 279041523.893881
 UNITED KINGDOM            |   1997 |   463069094.7336
 UNITED KINGDOM            |   1996 | 461022088.010259
 UNITED KINGDOM            |   1995 | 465445597.630493
 UNITED KINGDOM            |   1994 | 458869068.582222
 UNITED KINGDOM            |   1993 | 462142038.866584
 UNITED KINGDOM            |   1992 | 470251080.640241
 UNITED STATES             |   1998 | 273720909.330307
 UNITED STATES             |   1997 | 466360196.147667
 UNITED STATES             |   1996 | 469903610.970926
 UNITED STATES             |   1995 | 471886443.226458
 UNITED STATES             |   1994 | 470427696.448235
 UNITED STATES             |   1993 | 475781740.084076
 UNITED STATES             |   1992 | 467312504.546973
 VIETNAM                   |   1998 | 273867449.390838
 VIETNAM                   |   1997 | 468470073.337405
 VIETNAM                   |   1996 | 473692740.685912
 VIETNAM                   |   1995 | 467713782.017293
 VIETNAM                   |   1994 | 462875002.575142
 VIETNAM                   |   1993 | 469026362.220158
 VIETNAM                   |   1992 | 465451316.907016
(175 rows)

COMMIT;
COMMIT
