BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%grey%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 265777643.085582
 ALGERIA                   |   1997 | 452560791.322498
 ALGERIA                   |   1996 | 454112907.951206
 ALGERIA                   |   1995 | 458347056.558601
 ALGERIA                   |   1994 | 454733215.896273
 ALGERIA                   |   1993 |  454038442.55767
 ALGERIA                   |   1992 | 452867196.152028
 ARGENTINA                 |   1998 | 274300196.348283
 ARGENTINA                 |   1997 | 475873975.134771
 ARGENTINA                 |   1996 | 472754584.989885
 ARGENTINA                 |   1995 |  461133345.90812
 ARGENTINA                 |   1994 | 463148061.533183
 ARGENTINA                 |   1993 | 465048318.698976
 ARGENTINA                 |   1992 | 464063398.171707
 BRAZIL                    |   1998 | 274810951.135654
 BRAZIL                    |   1997 | 466870937.620578
 BRAZIL                    |   1996 | 465631497.210512
 BRAZIL                    |   1995 | 464603497.422727
 BRAZIL                    |   1994 | 462087195.947899
 BRAZIL                    |   1993 | 465069787.086767
 BRAZIL                    |   1992 | 474252873.789395
 CANADA                    |   1998 | 272918161.383509
 CANADA                    |   1997 | 478823665.368289
 CANADA                    |   1996 |  475669539.33783
 CANADA                    |   1995 | 470116492.315742
 CANADA                    |   1994 |  485510238.44853
 CANADA                    |   1993 |  470620314.47686
 CANADA                    |   1992 | 472371628.934918
 CHINA                     |   1998 | 272434988.125392
 CHINA                     |   1997 | 469594572.982255
 CHINA                     |   1996 | 465648969.124351
 CHINA                     |   1995 | 464628885.436262
 CHINA                     |   1994 | 463545454.070681
 CHINA                     |   1993 | 465968086.633772
 CHINA                     |   1992 | 473624302.337377
 EGYPT                     |   1998 | 276919415.958294
 EGYPT                     |   1997 | 463913892.691546
 EGYPT                     |   1996 | 470499725.148162
 EGYPT                     |   1995 | 455729681.973675
 EGYPT                     |   1994 | 457153320.997224
 EGYPT                     |   1993 | 460901180.735191
 EGYPT                     |   1992 | 459169123.972861
 ETHIOPIA                  |   1998 | 270502869.179185
 ETHIOPIA                  |   1997 | 456378379.096206
 ETHIOPIA                  |   1996 | 457955977.647211
 ETHIOPIA                  |   1995 | 460301911.419284
 ETHIOPIA                  |   1994 | 465468889.203363
 ETHIOPIA                  |   1993 |  461400154.01234
 ETHIOPIA                  |   1992 | 463653462.798171
 FRANCE                    |   1998 | 268260124.873933
 FRANCE                    |   1997 | 457056863.110647
 FRANCE                    |   1996 | 461284817.435267
 FRANCE                    |   1995 | 459413195.108816
 FRANCE                    |   1994 | 456048220.096303
 FRANCE                    |   1993 | 450478880.449963
 FRANCE                    |   1992 | 457434342.000752
 GERMANY                   |   1998 | 283095853.712652
 GERMANY                   |   1997 | 480936286.666304
 GERMANY                   |   1996 | 473183851.872419
 GERMANY                   |   1995 | 483171632.894483
 GERMANY                   |   1994 | 481947544.135184
 GERMANY                   |   1993 | 475341466.943025
 GERMANY                   |   1992 | 469812626.053689
 INDIA                     |   1998 | 274695024.468874
 INDIA                     |   1997 | 481039377.036436
 INDIA                     |   1996 | 477002736.504724
 INDIA                     |   1995 | 468021892.769599
 INDIA                     |   1994 | 481087083.467291
 INDIA                     |   1993 | 472014598.573236
 INDIA                     |   1992 | 475986863.814273
 INDONESIA                 |   1998 | 277095133.491735
 INDONESIA                 |   1997 | 463227076.939441
 INDONESIA                 |   1996 |  461798785.91873
 INDONESIA                 |   1995 | 466240497.752336
 INDONESIA                 |   1994 | 465928180.986046
 INDONESIA                 |   1993 | 468460974.910074
 INDONESIA                 |   1992 | 466526849.476782
 IRAN                      |   1998 |  275406515.74816
 IRAN                      |   1997 | 462168130.458959
 IRAN                      |   1996 |  453600670.22913
 IRAN                      |   1995 | 457668879.257456
 IRAN                      |   1994 | 452867728.938927
 IRAN                      |   1993 |  458790044.35127
 IRAN                      |   1992 | 453278502.815263
 IRAQ                      |   1998 | 277782925.510718
 IRAQ                      |   1997 | 467446665.664283
 IRAQ                      |   1996 |  469167702.26787
 IRAQ                      |   1995 | 466742510.239986
 IRAQ                      |   1994 | 475737923.812746
 IRAQ                      |   1993 |    463690013.732
 IRAQ                      |   1992 | 474252630.019956
 JAPAN                     |   1998 | 270544718.226578
 JAPAN                     |   1997 | 472641304.091882
 JAPAN                     |   1996 | 461031342.246148
 JAPAN                     |   1995 | 464860766.362162
 JAPAN                     |   1994 | 460157558.925124
 JAPAN                     |   1993 | 463348679.621829
 JAPAN                     |   1992 | 465651630.290008
 JORDAN                    |   1998 | 274201386.639175
 JORDAN                    |   1997 | 464966452.741614
 JORDAN                    |   1996 | 467040891.178991
 JORDAN                    |   1995 | 463129764.120609
 JORDAN                    |   1994 | 459550507.847337
 JORDAN                    |   1993 | 460668667.204914
 JORDAN                    |   1992 | 465130927.969816
 KENYA                     |   1998 | 275253083.170009
 KENYA                     |   1997 |  483928843.66907
 KENYA                     |   1996 |  485810585.71946
 KENYA                     |   1995 | 470379141.267715
 KENYA                     |   1994 | 472885410.474569
 KENYA                     |   1993 | 469509916.346674
 KENYA                     |   1992 |  475478565.67465
 MOROCCO                   |   1998 | 278171825.410473
 MOROCCO                   |   1997 | 469802561.579058
 MOROCCO                   |   1996 | 468654931.738684
 MOROCCO                   |   1995 | 470703839.650845
 MOROCCO                   |   1994 | 466353449.845004
 MOROCCO                   |   1993 | 465612573.617549
 MOROCCO                   |   1992 | 473245812.917926
 MOZAMBIQUE                |   1998 |   268867632.6221
 MOZAMBIQUE                |   1997 | 461511392.049567
 MOZAMBIQUE                |   1996 | 462099913.613266
 MOZAMBIQUE                |   1995 | 458325414.099257
 MOZAMBIQUE                |   1994 | 463770143.898211
 MOZAMBIQUE                |   1993 | 467394178.186942
 MOZAMBIQUE                |   1992 | 468156162.686999
 PERU                      |   1998 |  276513220.60482
 PERU                      |   1997 | 462868976.906256
 PERU                      |   1996 | 462399849.620582
 PERU                      |   1995 | 452627079.840842
 PERU                      |   1994 | 458189919.670456
 PERU                      |   1993 | 455701458.526313
 PERU                      |   1992 | 456728370.371412
 ROMANIA                   |   1998 | 274878869.402869
 ROMANIA                   |   1997 | 465251662.274332
 ROMANIA                   |   1996 | 465706075.773082
 ROMANIA                   |   1995 | 467060332.729011
 ROMANIA                   |   1994 | 468618054.272737
 ROMANIA                   |   1993 | 461636303.699181
 ROMANIA                   |   1992 | 466445904.057133
 RUSSIA                    |   1998 | 274255260.931969
 RUSSIA                    |   1997 | 464958716.305977
 RUSSIA                    |   1996 | 474368646.218682
 RUSSIA                    |   1995 | 471349877.696245
 RUSSIA                    |   1994 | 472854726.578855
 RUSSIA                    |   1993 | 465556582.893221
 RUSSIA                    |   1992 | 469608988.144485
 SAUDI ARABIA              |   1998 | 278005104.875073
 SAUDI ARABIA              |   1997 | 469074033.197894
 SAUDI ARABIA              |   1996 | 465899277.692261
 SAUDI ARABIA              |   1995 | 468164273.982573
 SAUDI ARABIA              |   1994 | 467605938.048797
 SAUDI ARABIA              |   1993 | 466222218.714371
 SAUDI ARABIA              |   1992 | 467967814.666635
 UNITED KINGDOM            |   1998 | 272986870.611499
 UNITED KINGDOM            |   1997 |  460267726.57991
 UNITED KINGDOM            |   1996 | 460383889.538206
 UNITED KINGDOM            |   1995 | 459251351.365765
 UNITED KINGDOM            |   1994 | 459498914.267845
 UNITED KINGDOM            |   1993 | 461164012.961773
 UNITED KINGDOM            |   1992 | 455436677.273843
 UNITED STATES             |   1998 | 272761348.724192
 UNITED STATES             |   1997 | 476266080.004454
 UNITED STATES             |   1996 | 471900999.815079
 UNITED STATES             |   1995 | 464844148.285854
 UNITED STATES             |   1994 | 469994635.936209
 UNITED STATES             |   1993 |  472036722.41819
 UNITED STATES             |   1992 | 470921184.846864
 VIETNAM                   |   1998 | 269243211.575909
 VIETNAM                   |   1997 | 462433291.743222
 VIETNAM                   |   1996 | 462885600.713229
 VIETNAM                   |   1995 | 459188964.934099
 VIETNAM                   |   1994 | 463396964.403923
 VIETNAM                   |   1993 | 466682723.799063
 VIETNAM                   |   1992 |  460870822.42951
(175 rows)

COMMIT;
COMMIT
