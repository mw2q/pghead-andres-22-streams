BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%sky%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 271836683.089085
 ALGERIA                   |   1997 | 454611508.894181
 ALGERIA                   |   1996 | 462400057.428229
 ALGERIA                   |   1995 | 458688427.908669
 ALGERIA                   |   1994 | 467204908.366271
 ALGERIA                   |   1993 |  456927368.49187
 ALGERIA                   |   1992 | 457002416.239911
 ARGENTINA                 |   1998 | 273933581.456382
 ARGENTINA                 |   1997 | 461878980.234231
 ARGENTINA                 |   1996 | 463123001.916627
 ARGENTINA                 |   1995 | 461475981.218943
 ARGENTINA                 |   1994 | 461213496.898535
 ARGENTINA                 |   1993 | 462755492.453749
 ARGENTINA                 |   1992 | 465568089.253693
 BRAZIL                    |   1998 | 275833781.665952
 BRAZIL                    |   1997 | 458896361.701023
 BRAZIL                    |   1996 | 465258022.983159
 BRAZIL                    |   1995 | 466504620.067213
 BRAZIL                    |   1994 | 466037319.978462
 BRAZIL                    |   1993 | 467320350.996097
 BRAZIL                    |   1992 | 470397588.958449
 CANADA                    |   1998 | 275539788.389786
 CANADA                    |   1997 | 475339965.360458
 CANADA                    |   1996 | 479503265.446918
 CANADA                    |   1995 | 472602084.299537
 CANADA                    |   1994 | 479062099.062928
 CANADA                    |   1993 | 474824848.316398
 CANADA                    |   1992 | 483651048.032269
 CHINA                     |   1998 | 281334064.895211
 CHINA                     |   1997 | 462917883.806813
 CHINA                     |   1996 | 477867812.928601
 CHINA                     |   1995 | 474473578.991047
 CHINA                     |   1994 | 471447932.106538
 CHINA                     |   1993 | 480685027.757649
 CHINA                     |   1992 | 473200675.525304
 EGYPT                     |   1998 | 275841743.089015
 EGYPT                     |   1997 | 478316380.145612
 EGYPT                     |   1996 | 470095344.500326
 EGYPT                     |   1995 | 475295514.037614
 EGYPT                     |   1994 | 474186542.577424
 EGYPT                     |   1993 | 481185082.036709
 EGYPT                     |   1992 | 469695076.277974
 ETHIOPIA                  |   1998 |  269371522.58102
 ETHIOPIA                  |   1997 | 453802760.676153
 ETHIOPIA                  |   1996 | 465646573.097961
 ETHIOPIA                  |   1995 | 452180001.924759
 ETHIOPIA                  |   1994 | 458038551.234084
 ETHIOPIA                  |   1993 | 460243361.572211
 ETHIOPIA                  |   1992 | 459456171.888081
 FRANCE                    |   1998 | 265241196.234424
 FRANCE                    |   1997 |  463813508.51027
 FRANCE                    |   1996 | 458614331.809368
 FRANCE                    |   1995 | 456774310.162838
 FRANCE                    |   1994 | 458049667.865837
 FRANCE                    |   1993 | 462013555.939901
 FRANCE                    |   1992 | 463309495.139828
 GERMANY                   |   1998 | 285183678.406838
 GERMANY                   |   1997 | 474272103.922194
 GERMANY                   |   1996 | 476539146.400091
 GERMANY                   |   1995 | 478058954.618048
 GERMANY                   |   1994 | 480411966.059617
 GERMANY                   |   1993 | 472403683.299367
 GERMANY                   |   1992 | 478513397.455172
 INDIA                     |   1998 | 273284271.074015
 INDIA                     |   1997 | 471801715.580337
 INDIA                     |   1996 | 479717092.773722
 INDIA                     |   1995 | 474441008.305346
 INDIA                     |   1994 | 480469226.261328
 INDIA                     |   1993 | 478044518.797328
 INDIA                     |   1992 | 479930585.130121
 INDONESIA                 |   1998 | 268910009.363778
 INDONESIA                 |   1997 | 465234204.855869
 INDONESIA                 |   1996 | 469917105.301707
 INDONESIA                 |   1995 | 469511596.766667
 INDONESIA                 |   1994 | 471708059.994793
 INDONESIA                 |   1993 | 470548102.857186
 INDONESIA                 |   1992 | 475078302.461019
 IRAN                      |   1998 |  275908738.08497
 IRAN                      |   1997 | 468677162.154905
 IRAN                      |   1996 | 466266874.488759
 IRAN                      |   1995 |  462997608.37899
 IRAN                      |   1994 | 462213989.841117
 IRAN                      |   1993 | 461923537.276158
 IRAN                      |   1992 | 468404519.511832
 IRAQ                      |   1998 | 271766981.089168
 IRAQ                      |   1997 | 474155102.714637
 IRAQ                      |   1996 | 466945108.083644
 IRAQ                      |   1995 | 462456970.581363
 IRAQ                      |   1994 | 473056331.755266
 IRAQ                      |   1993 | 474766699.184265
 IRAQ                      |   1992 |  469670379.05248
 JAPAN                     |   1998 | 266884923.663066
 JAPAN                     |   1997 | 470474031.150842
 JAPAN                     |   1996 | 466594097.184219
 JAPAN                     |   1995 | 463686384.196494
 JAPAN                     |   1994 |  467497783.32261
 JAPAN                     |   1993 | 463301147.498715
 JAPAN                     |   1992 | 472562093.233567
 JORDAN                    |   1998 |  274638988.38466
 JORDAN                    |   1997 | 467025899.702383
 JORDAN                    |   1996 | 461999912.101024
 JORDAN                    |   1995 |  460585059.97123
 JORDAN                    |   1994 | 465381549.917356
 JORDAN                    |   1993 | 461308580.098338
 JORDAN                    |   1992 | 468674545.486881
 KENYA                     |   1998 | 279306926.046993
 KENYA                     |   1997 | 470292368.170686
 KENYA                     |   1996 |  482871175.95585
 KENYA                     |   1995 |  472580470.00147
 KENYA                     |   1994 | 482381027.058308
 KENYA                     |   1993 |  475446318.14046
 KENYA                     |   1992 | 477938992.408342
 MOROCCO                   |   1998 | 272578182.228048
 MOROCCO                   |   1997 | 473006357.612698
 MOROCCO                   |   1996 | 474179024.290064
 MOROCCO                   |   1995 | 476473971.942652
 MOROCCO                   |   1994 | 468147070.032469
 MOROCCO                   |   1993 | 474727071.347777
 MOROCCO                   |   1992 | 471111599.425425
 MOZAMBIQUE                |   1998 | 274731436.221969
 MOZAMBIQUE                |   1997 | 460840303.705332
 MOZAMBIQUE                |   1996 | 462157223.493153
 MOZAMBIQUE                |   1995 | 455350924.489934
 MOZAMBIQUE                |   1994 | 461567491.494712
 MOZAMBIQUE                |   1993 |  458752138.06226
 MOZAMBIQUE                |   1992 | 464920124.810793
 PERU                      |   1998 | 274755094.780894
 PERU                      |   1997 | 465867065.340283
 PERU                      |   1996 | 468902638.499557
 PERU                      |   1995 | 467608785.438032
 PERU                      |   1994 | 466854290.901793
 PERU                      |   1993 | 467471948.753395
 PERU                      |   1992 | 473272463.813541
 ROMANIA                   |   1998 | 280771045.298645
 ROMANIA                   |   1997 | 477529508.622412
 ROMANIA                   |   1996 | 476427985.917184
 ROMANIA                   |   1995 |  477614551.60033
 ROMANIA                   |   1994 | 472769468.974293
 ROMANIA                   |   1993 | 468670759.495667
 ROMANIA                   |   1992 | 472812072.400258
 RUSSIA                    |   1998 | 280906705.124856
 RUSSIA                    |   1997 | 476657997.404827
 RUSSIA                    |   1996 | 475782239.657019
 RUSSIA                    |   1995 | 466819356.120945
 RUSSIA                    |   1994 | 460782903.693865
 RUSSIA                    |   1993 | 477090392.764548
 RUSSIA                    |   1992 | 470945085.905714
 SAUDI ARABIA              |   1998 | 275678716.624196
 SAUDI ARABIA              |   1997 |  474657736.62784
 SAUDI ARABIA              |   1996 | 478889017.657826
 SAUDI ARABIA              |   1995 | 476307465.229345
 SAUDI ARABIA              |   1994 | 470751208.054228
 SAUDI ARABIA              |   1993 | 476472365.419447
 SAUDI ARABIA              |   1992 | 473401207.150221
 UNITED KINGDOM            |   1998 | 270938160.207347
 UNITED KINGDOM            |   1997 | 462820933.591801
 UNITED KINGDOM            |   1996 | 455992888.568788
 UNITED KINGDOM            |   1995 | 464108928.013193
 UNITED KINGDOM            |   1994 | 462159794.708535
 UNITED KINGDOM            |   1993 | 461414193.706436
 UNITED KINGDOM            |   1992 | 461092480.271688
 UNITED STATES             |   1998 | 274356936.967693
 UNITED STATES             |   1997 | 468595614.122917
 UNITED STATES             |   1996 | 470145301.962031
 UNITED STATES             |   1995 | 460818393.324455
 UNITED STATES             |   1994 | 471049990.949393
 UNITED STATES             |   1993 | 462323303.656369
 UNITED STATES             |   1992 | 470625263.149028
 VIETNAM                   |   1998 | 273453691.205232
 VIETNAM                   |   1997 |  466603381.03063
 VIETNAM                   |   1996 | 479694475.940242
 VIETNAM                   |   1995 | 465140361.617101
 VIETNAM                   |   1994 | 461951431.749464
 VIETNAM                   |   1993 | 472951036.571162
 VIETNAM                   |   1992 | 460799881.594163
(175 rows)

COMMIT;
COMMIT
