BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%linen%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 258040060.997784
 ALGERIA                   |   1997 | 448089039.255689
 ALGERIA                   |   1996 | 457077507.030704
 ALGERIA                   |   1995 |   455410711.9388
 ALGERIA                   |   1994 | 447016870.927401
 ALGERIA                   |   1993 | 453754965.313276
 ALGERIA                   |   1992 | 450103688.693046
 ARGENTINA                 |   1998 | 275527838.452746
 ARGENTINA                 |   1997 | 472122011.096449
 ARGENTINA                 |   1996 | 470027764.464853
 ARGENTINA                 |   1995 | 474368809.076645
 ARGENTINA                 |   1994 | 464074349.345979
 ARGENTINA                 |   1993 |  473919607.36353
 ARGENTINA                 |   1992 | 478562959.769322
 BRAZIL                    |   1998 | 277785248.313315
 BRAZIL                    |   1997 | 470545689.175642
 BRAZIL                    |   1996 | 461803048.609969
 BRAZIL                    |   1995 | 463060914.135775
 BRAZIL                    |   1994 |  463699836.98887
 BRAZIL                    |   1993 | 461511127.731618
 BRAZIL                    |   1992 | 467030629.359451
 CANADA                    |   1998 | 272068904.132933
 CANADA                    |   1997 | 477049785.060701
 CANADA                    |   1996 | 474968099.020231
 CANADA                    |   1995 | 472073397.085273
 CANADA                    |   1994 | 472936156.411099
 CANADA                    |   1993 | 474395404.573593
 CANADA                    |   1992 | 471168045.312646
 CHINA                     |   1998 | 272324003.453429
 CHINA                     |   1997 | 465738442.303229
 CHINA                     |   1996 | 464351708.217035
 CHINA                     |   1995 | 461470768.600807
 CHINA                     |   1994 | 463611456.664838
 CHINA                     |   1993 | 465254228.269234
 CHINA                     |   1992 | 471237195.327515
 EGYPT                     |   1998 | 270846668.723466
 EGYPT                     |   1997 | 458519010.622722
 EGYPT                     |   1996 |  470962118.04184
 EGYPT                     |   1995 | 463580522.992199
 EGYPT                     |   1994 | 463136603.081521
 EGYPT                     |   1993 | 459844680.236843
 EGYPT                     |   1992 | 469116893.702355
 ETHIOPIA                  |   1998 | 264491768.233223
 ETHIOPIA                  |   1997 | 451142338.898911
 ETHIOPIA                  |   1996 | 441954226.992499
 ETHIOPIA                  |   1995 | 452015080.102571
 ETHIOPIA                  |   1994 | 456173191.914391
 ETHIOPIA                  |   1993 | 447435348.913908
 ETHIOPIA                  |   1992 | 457418933.310546
 FRANCE                    |   1998 | 263488610.919645
 FRANCE                    |   1997 | 453916669.971757
 FRANCE                    |   1996 |  447782248.98668
 FRANCE                    |   1995 | 445756964.350541
 FRANCE                    |   1994 |  453853493.21635
 FRANCE                    |   1993 | 452829202.491346
 FRANCE                    |   1992 | 459167395.661099
 GERMANY                   |   1998 | 278808560.033512
 GERMANY                   |   1997 | 470441926.841888
 GERMANY                   |   1996 | 474725080.987669
 GERMANY                   |   1995 | 471268965.589707
 GERMANY                   |   1994 | 479347654.247541
 GERMANY                   |   1993 | 477242631.858817
 GERMANY                   |   1992 | 470699312.790082
 INDIA                     |   1998 | 279722762.788346
 INDIA                     |   1997 | 474777120.000789
 INDIA                     |   1996 | 475824626.095128
 INDIA                     |   1995 | 472039928.155551
 INDIA                     |   1994 | 479242784.746348
 INDIA                     |   1993 | 477061577.331157
 INDIA                     |   1992 | 482295190.728983
 INDONESIA                 |   1998 | 273773650.049285
 INDONESIA                 |   1997 | 463189407.006287
 INDONESIA                 |   1996 | 463776904.915882
 INDONESIA                 |   1995 | 460537464.868062
 INDONESIA                 |   1994 | 461453475.286155
 INDONESIA                 |   1993 | 457827075.273156
 INDONESIA                 |   1992 | 457276996.000156
 IRAN                      |   1998 | 273600774.241754
 IRAN                      |   1997 | 459381593.223861
 IRAN                      |   1996 | 469292899.323452
 IRAN                      |   1995 | 473513325.094955
 IRAN                      |   1994 | 468399425.783482
 IRAN                      |   1993 | 467659551.540264
 IRAN                      |   1992 |  468680742.25265
 IRAQ                      |   1998 |  276740974.60288
 IRAQ                      |   1997 | 473905228.638873
 IRAQ                      |   1996 | 476309602.978371
 IRAQ                      |   1995 | 477794281.658135
 IRAQ                      |   1994 | 474287110.661276
 IRAQ                      |   1993 | 477737288.291592
 IRAQ                      |   1992 | 467944317.807382
 JAPAN                     |   1998 | 269287913.506314
 JAPAN                     |   1997 | 465049592.443189
 JAPAN                     |   1996 | 460041607.832735
 JAPAN                     |   1995 | 455588424.996104
 JAPAN                     |   1994 | 464266933.754718
 JAPAN                     |   1993 | 458165297.898531
 JAPAN                     |   1992 | 454528087.305149
 JORDAN                    |   1998 | 273519885.368588
 JORDAN                    |   1997 | 459398298.985781
 JORDAN                    |   1996 | 461077074.267677
 JORDAN                    |   1995 | 463551335.495921
 JORDAN                    |   1994 | 460524959.157273
 JORDAN                    |   1993 | 462443675.974466
 JORDAN                    |   1992 | 464451268.294735
 KENYA                     |   1998 | 267081675.618217
 KENYA                     |   1997 |  463757662.91869
 KENYA                     |   1996 | 472692502.590031
 KENYA                     |   1995 | 466250935.550419
 KENYA                     |   1994 | 470079847.589609
 KENYA                     |   1993 | 465053974.206547
 KENYA                     |   1992 | 461788926.906318
 MOROCCO                   |   1998 | 270483693.487141
 MOROCCO                   |   1997 | 458361323.159557
 MOROCCO                   |   1996 |  470198566.44061
 MOROCCO                   |   1995 | 454534927.289564
 MOROCCO                   |   1994 | 456520132.330566
 MOROCCO                   |   1993 | 459367272.127831
 MOROCCO                   |   1992 | 471856015.657748
 MOZAMBIQUE                |   1998 | 273148057.149239
 MOZAMBIQUE                |   1997 | 465276581.526999
 MOZAMBIQUE                |   1996 | 463813717.182471
 MOZAMBIQUE                |   1995 |  465120692.67993
 MOZAMBIQUE                |   1994 |  460039548.32123
 MOZAMBIQUE                |   1993 | 467787128.390043
 MOZAMBIQUE                |   1992 | 458357967.082688
 PERU                      |   1998 | 268721660.652832
 PERU                      |   1997 | 468239108.929801
 PERU                      |   1996 | 464588005.668145
 PERU                      |   1995 |  472001637.37751
 PERU                      |   1994 | 468347287.182887
 PERU                      |   1993 |  464084936.29729
 PERU                      |   1992 | 477961303.229304
 ROMANIA                   |   1998 | 276222191.125676
 ROMANIA                   |   1997 | 461942385.034054
 ROMANIA                   |   1996 |  476477334.21945
 ROMANIA                   |   1995 | 469497239.791659
 ROMANIA                   |   1994 | 473140991.215371
 ROMANIA                   |   1993 | 465281870.270871
 ROMANIA                   |   1992 | 466343178.326552
 RUSSIA                    |   1998 | 270753960.433858
 RUSSIA                    |   1997 | 467967310.674063
 RUSSIA                    |   1996 | 464660206.856433
 RUSSIA                    |   1995 |  465167325.85009
 RUSSIA                    |   1994 | 457272627.528782
 RUSSIA                    |   1993 | 460966842.534293
 RUSSIA                    |   1992 | 468038902.663017
 SAUDI ARABIA              |   1998 | 273161625.275961
 SAUDI ARABIA              |   1997 | 462777369.114492
 SAUDI ARABIA              |   1996 | 472893999.210315
 SAUDI ARABIA              |   1995 | 470383736.916726
 SAUDI ARABIA              |   1994 | 461070713.871414
 SAUDI ARABIA              |   1993 | 469491672.239151
 SAUDI ARABIA              |   1992 | 464368989.082111
 UNITED KINGDOM            |   1998 |  273618257.05317
 UNITED KINGDOM            |   1997 | 471826403.348524
 UNITED KINGDOM            |   1996 | 466868201.587946
 UNITED KINGDOM            |   1995 |  466387768.53306
 UNITED KINGDOM            |   1994 | 463243599.701048
 UNITED KINGDOM            |   1993 |  456126665.40425
 UNITED KINGDOM            |   1992 | 461604284.708031
 UNITED STATES             |   1998 | 278835148.548285
 UNITED STATES             |   1997 | 467374190.861226
 UNITED STATES             |   1996 | 471222889.819816
 UNITED STATES             |   1995 | 474615273.904038
 UNITED STATES             |   1994 | 480134102.248336
 UNITED STATES             |   1993 | 470448063.386966
 UNITED STATES             |   1992 | 473481078.763353
 VIETNAM                   |   1998 | 274728243.109611
 VIETNAM                   |   1997 | 463841798.307446
 VIETNAM                   |   1996 | 473534235.036586
 VIETNAM                   |   1995 | 463170020.844217
 VIETNAM                   |   1994 | 469272580.920829
 VIETNAM                   |   1993 | 469662060.558947
 VIETNAM                   |   1992 | 470310601.610431
(175 rows)

COMMIT;
COMMIT
